<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facture {{ hotel.hotelName }}</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 5px;
            margin: 0;
        }
        
        .invoice-container {
            background: white;
            width: 210mm;
            min-height: 297mm;
            margin: 0 auto;
            padding: 30px;
            border: 2px solid #000;
            box-sizing: border-box;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .company-name {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .company-details {
            font-size: 11px;
            line-height: 1.6;
        }
        
        .invoice-title {
            text-align: center;
            font-size: 16px;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .guest-info {
            font-size: 11px;
            margin-bottom: 0px;
        }
        
        .guest-info table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .guest-info td {
            padding: 2px;
        }
        
        .guest-info td:first-child {
            width: 150px;
        }
        
        .transaction-table {
            width: calc(100% + 60px);
            margin-left: -30px;
            margin-right: -30px;
            border-collapse: collapse;
            margin-top: 20px;
            margin-bottom: 20px;
            font-size: 11px;
        }
        
        .transaction-table thead {
            border-top: 2px solid #000;
            border-bottom: 2px solid #000;
        }
        
        .transaction-table th {
            padding: 8px 30px 8px 5px;
            text-align: left;
            font-weight: bold;
            border: none;
        }
        
        .transaction-table td {
            padding: 8px 30px 8px 5px;
            text-align: left;
            border: none;
        }
        
        .transaction-table td:nth-child(1) {
            width: 90px;
            white-space: nowrap;
        }
        
        .transaction-table td:nth-child(5),
        .transaction-table td:nth-child(6) {
            text-align: right;
        }
        
        .transaction-table .total-row-table {
            border-top: none;
            border-bottom: none;
        }
        
        .transaction-table .total-row-table td {
            padding-top: 10px;
            padding-bottom: 10px;
        }
        
        .transaction-table .total-row-table td:nth-child(4) {
            text-align: right;
            padding-right: 10px;
        }
        
        /* Bordures séparées pour chaque colonne avec espaces réduits */
        .transaction-table .total-row-table td:nth-child(4) {
            position: relative;
        }
        
        .transaction-table .total-row-table td:nth-child(4)::before {
            content: '';
            position: absolute;
            left: 30%;
            right: 5px;
            top: 0;
            border-top: double 3px #000;
        }
        
        .transaction-table .total-row-table td:nth-child(4)::after {
            content: '';
            position: absolute;
            left: 30%;
            right: 5px;
            bottom: 0;
            border-bottom: double 3px #000;
        }
        
        .transaction-table .total-row-table td:nth-child(5) {
            position: relative;
        }
        
        .transaction-table .total-row-table td:nth-child(5)::before {
            content: '';
            position: absolute;
            left: 5px;
            right: 5px;
            top: 0;
            border-top: double 3px #000;
        }
        
        .transaction-table .total-row-table td:nth-child(5)::after {
            content: '';
            position: absolute;
            left: 5px;
            right: 5px;
            bottom: 0;
            border-bottom: double 3px #000;
        }
        
        .transaction-table .total-row-table td:nth-child(6) {
            position: relative;
        }
        
        .transaction-table .total-row-table td:nth-child(6)::before {
            content: '';
            position: absolute;
            left: 5px;
            right: 0;
            top: 0;
            border-top: double 3px #000;
        }
        
        .transaction-table .total-row-table td:nth-child(6)::after {
            content: '';
            position: absolute;
            left: 5px;
            right: 0;
            bottom: 0;
            border-bottom: double 3px #000;
        }
        
        .summary-section {
            margin-top: 0;
            font-size: 11px;
            display: flex;
            justify-content: flex-end;
            position: relative;
        }
        
        .summary-table {
            width: 350px;
            border-collapse: collapse;
            margin-right: calc(100% - 100%);
        }
        
        .summary-table td {
            padding: 4px 5px;
            position: relative;
        }
        
        .summary-table td:first-child {
            text-align: right;
            padding-right: 10px;
        }
        
        .summary-table td:last-child {
            text-align: right;
            width: 150px;
        }
        
        /* Bordures séparées pour Flat Discount */
        .summary-table tr.discount-row td:first-child::after {
            content: '';
            position: absolute;
            left: -105px;
            right: 5px;
            bottom: 0;
            border-bottom: 1px solid #000;
        }
        
        .summary-table tr.discount-row td:last-child::after {
            content: '';
            position: absolute;
            left: 5px;
            right: -30px;
            bottom: 0;
            border-bottom: 1px solid #000;
        }
        
        /* Bordures séparées pour Total Payable */
        .summary-table tr.payable-row td:first-child::after {
            content: '';
            position: absolute;
            left: -105px;
            right: 5px;
            bottom: 0;
            border-bottom: 1px solid #000;
        }
        
        .summary-table tr.payable-row td:last-child::after {
            content: '';
            position: absolute;
            left: 5px;
            right: -30px;
            bottom: 0;
            border-bottom: 1px solid #000;
        }
        
        /* Bordures séparées pour Payment */
        .summary-table tr.payment-row td:first-child::after {
            content: '';
            position: absolute;
            left: -105px;
            right: 5px;
            bottom: 0;
            border-bottom: 1px solid #000;
        }
        
        .summary-table tr.payment-row td:last-child::after {
            content: '';
            position: absolute;
            left: 5px;
            right: -30px;
            bottom: 0;
            border-bottom: 1px solid #000;
        }
        
        /* Double bordure séparée seulement en bas pour Balance */
        .summary-table tr.balance-row td {
            font-weight: bold;
            padding-top: 8px;
            padding-bottom: 8px;
        }
        
        .summary-table tr.balance-row td:first-child::after {
            content: '';
            position: absolute;
            left: -105px;
            right: 5px;
            bottom: 0;
            border-bottom: double 3px #000;
        }
        
        .summary-table tr.balance-row td:last-child::after {
            content: '';
            position: absolute;
            left: 5px;
            right: -30px;
            bottom: 0;
            border-bottom: double 3px #000;
        }
    </style>
</head>
<body>
    <div class="invoice-container">
        <div class="header">
            <div class="company-name">{{ hotel.hotelName }}</div>
            <div class="company-details">
                {{ hotel.address }}, {{ hotel.city }}, {{ hotel.stateProvince }}, {{ hotel.postalCode }}, {{ hotel.country }}<br>
                Phone: {{ hotel.phoneNumber }}; E-mail : {{ hotel.email }}<br>
                webSite: {{ hotel.website }}<br>
                @if(hotel.registrationNo1)
                GST ID No : {{ hotel.registrationNo1 }}
                @endif
            </div>
        </div>
        
        <div class="invoice-title">Tax Invoice</div>
        
        <div class="guest-info">
            <table>
                <tr>
                    <td><strong>Guest Name</strong></td>
                    <td>: {{ guest.title }} {{ guest.firstName }} {{ guest.lastName }}</td>
                    <td><strong>Invoice No</strong></td>
                    <td>: 
                        @each(folio in folios)
                            {{ folio.folioNumber }}
                        @endeach
                    </td>
                </tr>
                <tr>
                    <td><strong>Guest GST ID</strong></td>
                    <td>: {{ guest.gstinNo || 'N/A' }}</td>
                    <td><strong>Invoice Date</strong></td>
                    <td>: {{ currentDate.split(' ')[0] }}</td>
                </tr>
                <tr>
                    <td><strong>Address</strong></td>
                    <td>: {{ guest.addressLine }},</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td></td>
                    <td>{{ guest.city }} - {{ guest.postalCode }}</td>
                    <td></td>
                    <td></td>
                </tr>
                <tr>
                    <td><strong>Nationality</strong></td>
                    <td>: {{ guest.nationality }}</td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>
        
        <table class="transaction-table">
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Ref. No.</th>
                    <th>Tax Code</th>
                    <th>Particular</th>
                    <th>Debit ({{ currency }})</th>
                    <th>Credit ({{ currency }})</th>
                </tr>
            </thead>
            <tbody>
                <!-- Afficher toutes les transactions dans l'ordre -->
                @each(transaction in transactions)
                <tr>
                    <td>{{ transaction.transactionDate.toFormat('dd-MM-yyyy') }}</td>
                    <td>{{ transaction.transactionNumber }}</td>
                    <td>
                    0
                    </td>
                    <td>{{ transaction.particular || transaction.description }}</td>
                    <td>
                        @if(transaction.transactionType !== 'payment')
                        {{ formatNumber(Math.abs(parseFloat(transaction.amount))) }}
                        @else
                        0
                        @endif
                    </td>
                    <td>
                        @if(transaction.transactionType === 'payment')
                        {{ formatNumber(Math.abs(parseFloat(transaction.amount))) }}
                        @else
                        0
                        @endif
                    </td>
                </tr>
                @endeach
                
                <tr class="total-row-table">
                    <td></td>
                    <td></td>
                    <td></td>
                    <td style="text-align: right; padding-right: 10px;"><strong>Total ({{ currency }})</strong></td>
                    <td><strong>{{ formatNumber(summary.totalCharges + summary.totalTaxes) }}</strong></td>
                    <td><strong>{{ formatNumber(summary.totalPayments) }}</strong></td>
                </tr>
            </tbody>
        </table>
        
        <div class="summary-section">
            <table class="summary-table">
                <tr>
                    <td style="font-weight: bold;">Total Charges ({{ currency }}) :</td>
                    <td>{{ formatNumber(summary.totalCharges) }}</td>
                </tr>
                <tr class="discount-row">
                    <td style="font-weight: bold;">TVA ({{ currency }}) :</td>
                    <td>{{ formatNumber(summary.totalTaxes) }}</td>
                </tr>
                <tr class="payable-row">
                    <td style="font-weight: bold;">Total Payable ({{ currency }}) :</td>
                    <td>{{ formatNumber(summary.totalCharges + summary.totalTaxes) }}</td>
                </tr>
                <tr>
                    <td style="font-weight: bold;">Flat Discount ({{ currency }}) :</td>
                    <td>{{ formatNumber(summary.totalDiscounts) }}</td>
                </tr>
                <tr class="payment-row">
                    <td style="font-weight: bold;">Payment ({{ currency }}) :</td>
                    <td>{{ formatNumber(summary.totalPayments) }}</td>
                </tr>
                <tr class="balance-row">
                    <td style="font-weight: bold;">Balance ({{ currency }}) :</td>
                    <td>{{ formatNumber((summary.totalCharges + summary.totalTaxes) - summary.totalPayments) }}</td>
                </tr>
            </table>
        </div>
        
    </div>
</body>
</html>